<!DOCTYPE html>
<html>
<head>
    <title>Attendees for {{ event.name }}</title>
</head>
<body>
    <h1>Attendees for {{ event.name }}</h1>
    <p>Only attendees with successful payments are displayed below.</p>
    <table>
        <thead>
            <tr>
                <th>Attendee ID</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Tickets</th>
                <th>Total Paid (£)</th>
                <th>Payment Status</th>
                <th>Date Purchased</th>
            </tr>
        </thead>
        <tbody>
            {% for attendee in attendees %}
            <tr>
                <td>{{ attendee.id }}</td>
                <td>{{ attendee.full_name }}</td>
                <td>{{ attendee.email }}</td>
                <td>{{ attendee.phone_number }}</td>
                <td>
                    <ul>
                    {% for ticket in attendee.tickets %}
                        <li>
                            {% set ticket_answers = ticket.ticket_answers | fromjson %}
                            {% for question, answer in ticket_answers.items() %}
                                <strong>{{ question }}:</strong> {{ answer }}<br>
                            {% endfor %}
                            <!-- Delete button -->
                            <form action="{{ url_for('delete_ticket', event_id=event.id, ticket_id=ticket.id) }}" method="post" style="display:inline;">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this ticket?');">Delete Ticket</button>
                            </form>
                        </li>
                    {% endfor %}
                    </ul>
                </td>
                <td>£{{ '%.2f' % (attendee.ticket_price_at_purchase * attendee.tickets|count) }}</td>
                <td>{{ attendee.payment_status }}</td>
                <td>{{ attendee.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>    
    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
</body>
</html>
