{% extends "partials/base.html" %}

{% block content %}
<div class="purchase-container">
    <div class="purchase-form">
        <h1>Purchase Tickets for {{ event.name }}</h1>
        <p>{{ event.description }}</p>
        <p><strong>Date:</strong> {{ event.date }}</p>
        <p><strong>Location:</strong> {{ event.location }}</p>
        <p><strong>Price per ticket:</strong> Â£{{ event.ticket_price }}</p>

        <form method="POST">
            <!-- Number of Tickets -->
            <div class="form-group">
                <label for="number_of_tickets">Number of Tickets:</label>
                <input
                    type="number"
                    id="number_of_tickets"
                    name="number_of_tickets"
                    min="1"
                    max="{{ event.ticket_quantity }}"
                    value="1"
                    required
                >
            </div>

            <!-- Buyer Information -->
            <h2>Your Information</h2>

            <div class="form-group">
                <label for="full_name">Full Name:</label>
                <input type="text" id="full_name" name="full_name" required>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="phone_number">Telephone Number:</label>
                <input type="tel" id="phone_number" name="phone_number" required>
            </div>

            <!-- Ticket Questions -->
            <h2>Attendee Information</h2>
            <div id="question_forms">
                <!-- Question forms will be dynamically added here -->
            </div>

            <!-- Terms and Conditions Checkboxes -->
            <h2>Terms and Conditions</h2>
            <div class="form-group checkbox-group">
                <input type="checkbox" id="accept_organizer_terms" name="accept_organizer_terms" required>
                <label for="accept_organizer_terms">
                    I accept the <a href="{{ organizer_terms_link }}" target="_blank">event organizer's Terms and Conditions</a>.
                </label>
            </div>
            <div class="form-group checkbox-group">
                <input type="checkbox" id="accept_platform_terms" name="accept_platform_terms" required>
                <label for="accept_platform_terms">
                    I accept the <a href="{{ platform_terms_link }}" target="_blank">platform's Terms and Conditions</a>.
                </label>
            </div>

            <input type="submit" value="Proceed to Payment" class="submit-btn">
        </form>

        {% if error %}
            <p class="error-msg">{{ error }}</p>
        {% endif %}
    </div>
</div>

<!-- Include your JavaScript code after the form -->
<script type="application/json" id="questions-data">
    {{ questions | tojson }}
</script>

<script>
    // Parse the questions data from the script tag
    var questionsDataElement = document.getElementById('questions-data');
    var questions = JSON.parse(questionsDataElement.textContent);

    function updateQuestionForms() {
        var numberOfTickets = document.getElementById('number_of_tickets').value;
        var formsContainer = document.getElementById('question_forms');
        formsContainer.innerHTML = '';

        for (var i = 0; i < numberOfTickets; i++) {
            var ticketDiv = document.createElement('div');
            ticketDiv.classList.add('attendee-group');

            var attendeeHeader = document.createElement('h3');
            attendeeHeader.textContent = 'Attendee ' + (i + 1);
            ticketDiv.appendChild(attendeeHeader);

            for (var j = 0; j < questions.length; j++) {
                var formGroup = document.createElement('div');
                formGroup.classList.add('form-group');

                var label = document.createElement('label');
                label.setAttribute('for', 'ticket_' + i + '_question_' + j);
                label.textContent = questions[j];

                var input = document.createElement('input');
                input.type = 'text';
                input.name = 'ticket_' + i + '_question_' + j;
                input.required = true;

                formGroup.appendChild(label);
                formGroup.appendChild(input);
                ticketDiv.appendChild(formGroup);
            }

            formsContainer.appendChild(ticketDiv);
        }
    }

    document.addEventListener('DOMContentLoaded', updateQuestionForms);
    document.getElementById('number_of_tickets').addEventListener('change', updateQuestionForms);
    document.getElementById('number_of_tickets').addEventListener('input', updateQuestionForms);
</script>

<style>
    /* Scoped styles for the purchase page */

    .purchase-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 50px auto;
        max-width: 800px;
        padding: 20px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .purchase-form {
        width: 100%;
        padding: 20px;
        background-color: white;
    }

    .purchase-form h1 {
        color: #ff0000; /* Red for your brand */
        margin-bottom: 20px;
    }

    .purchase-form h2 {
        color: #ff0000;
        margin-top: 30px;
        margin-bottom: 15px;
    }

    .purchase-form p {
        margin-bottom: 15px;
        color: #333;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
    }

    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="number"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f5f5f5;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .checkbox-group input[type="checkbox"] {
        margin-right: 10px;
    }

    .submit-btn {
        width: 100%;
        padding: 15px;
        background-color: #ff0000; /* Red for your brand */
        color: white;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
    }

    .submit-btn:hover {
        background-color: #cc0000; /* Darker red for hover */
    }

    .error-msg {
        color: red;
        margin-top: 15px;
    }

    .attendee-group {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
    }

    .attendee-group h3 {
        color: #ff0000;
        margin-bottom: 10px;
    }
</style>

{% endblock %}
